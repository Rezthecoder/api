<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jokes Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f9f9f9;
      }
      h1 {
        color: #333;
      }
      section {
        background: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      input,
      select,
      button {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        font-size: 16px;
      }
      button {
        background: #0070f3;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #005bb5;
      }
      .result {
        margin-top: 10px;
        padding: 10px;
        background: #e6f7ff;
        border: 1px solid #91d5ff;
        border-radius: 4px;
      }
      .joke-list {
        margin-top: 10px;
      }
      .joke-item {
        padding: 8px;
        border-bottom: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <h1>Jokes API Dashboard</h1>

    <!-- View All Jokes -->
    <section>
      <h2>View All Jokes</h2>
      <button onclick="fetchJokes()">Load Jokes</button>
      <div class="joke-list" id="jokeList"></div>
    </section>

    <!-- Create Joke -->
    <section>
      <h2>Create a Joke</h2>
      <form id="createForm">
        <input type="text" id="createText" placeholder="Joke text" required />
        <select id="createType" required>
          <option value="">Select type</option>
          <option value="General">General</option>
          <option value="Frontend">Frontend</option>
          <option value="Backend">Backend</option>
          <option value="Database">Database</option>
          <option value="Python">Python</option>
          <option value="Java">Java</option>
          <option value="DevOps">DevOps</option>
        </select>
        <button type="submit">Create Joke</button>
      </form>
      <div class="result" id="createResult" style="display: none"></div>
    </section>

    <!-- Update Joke -->
    <section>
      <h2>Update a Joke</h2>
      <form id="updateForm">
        <input type="number" id="updateId" placeholder="Joke ID" required />
        <input type="text" id="updateText" placeholder="New joke text" />
        <input type="text" id="updateType" placeholder="New joke type" />
        <button type="submit">Update Joke</button>
      </form>
      <div class="result" id="updateResult" style="display: none"></div>
    </section>

    <!-- Delete Joke -->
    <section>
      <h2>Delete a Joke</h2>
      <form id="deleteForm">
        <input type="number" id="deleteId" placeholder="Joke ID" required />
        <button type="submit">Delete Joke</button>
      </form>
      <div class="result" id="deleteResult" style="display: none"></div>
    </section>

    <script>
      const API_BASE = "https://api-sigma-six-55.vercel.app"; // Change if needed

      // Fetch all jokes
      async function fetchJokes() {
        const list = document.getElementById("jokeList");
        list.innerHTML = "Loading...";
        try {
          const res = await fetch(`${API_BASE}/jokes`);
          const data = await res.json();
          list.innerHTML = data
            .map(
              (j) =>
                `<div class="joke-item">ID ${j.id}: ${j.jokeText} (${j.jokeType})</div>`
            )
            .join("");
        } catch (err) {
          list.innerHTML = "Error loading jokes";
        }
      }

      // Create joke
      document
        .getElementById("createForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const jokeText = document.getElementById("createText").value.trim();
          const jokeType = document.getElementById("createType").value;
          const resultDiv = document.getElementById("createResult");
          try {
            const res = await fetch(`${API_BASE}/jokes`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ jokeText, jokeType }),
            });
            const data = await res.json();
            resultDiv.style.display = "block";
            resultDiv.textContent = res.ok
              ? `✅ Created: ID ${data.id} jokeText: ${jokeText} jokeType:${jokeType}`
              : `❌ Error: ${data.error}`;
          } catch (err) {
            resultDiv.style.display = "block";
            resultDiv.textContent = `❌ Request failed`;
          }
        });

      // Update joke
      document
        .getElementById("updateForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const id = document.getElementById("updateId").value;
          const jokeText = document.getElementById("updateText").value.trim();
          const jokeType = document.getElementById("updateType").value.trim();
          const resultDiv = document.getElementById("updateResult");
          try {
            const res = await fetch(`${API_BASE}/jokes/${id}`, {
              method: "PATCH",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ jokeText, jokeType }),
            });
            const data = await res.json();
            resultDiv.style.display = "block";
            resultDiv.textContent = res.ok
              ? `✅ Updated: ID ${data.id}`
              : `❌ Error: ${data.error}`;
          } catch (err) {
            resultDiv.style.display = "block";
            resultDiv.textContent = `❌ Request failed`;
          }
        });

      // Delete joke
      document
        .getElementById("deleteForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const id = document.getElementById("deleteId").value;
          const resultDiv = document.getElementById("deleteResult");
          try {
            const res = await fetch(`${API_BASE}/jokes/${id}`, {
              method: "DELETE",
            });
            resultDiv.style.display = "block";
            resultDiv.textContent = res.ok
              ? `✅ Deleted ID ${id}`
              : `❌ Error deleting`;
          } catch (err) {
            resultDiv.style.display = "block";
            resultDiv.textContent = `❌ Request failed`;
          }
        });
    </script>
  </body>
</html>
